<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Issues Tab — Unified Redesign (Issues #23 + #24)</title>
<style>
  /* ===== Design tokens (from tokens.css) ===== */
  :root {
    --ds-page: #fafafa;
    --ds-surface: #ffffff;
    --ds-surface-subtle: #fafafa;
    --ds-surface-hover: #f5f5f5;
    --ds-surface-active: #f8fbfd;
    --ds-primary: #1a1a1a;
    --ds-secondary: #666666;
    --ds-muted: #999999;
    --ds-border: #e5e5e5;
    --ds-accent: #5b8fc7;
    --ds-accent-hover: #4a7db0;
    --ds-accent-muted: #d0e4f2;
    --ds-accent-bg: #f8fbfd;
    --ds-success: #5cb85c;
    --ds-warning: #f0ad4e;
    --ds-error: #dc3545;
    --ds-disabled: #cccccc;
    --ds-radius-sm: 4px;
    --ds-radius-md: 6px;
    --ds-duration: 0.2s;
    --ds-shadow-button: 0 4px 12px rgba(0,0,0,0.15), 0 2px 6px rgba(91,143,199,0.3);
    --ds-shadow-button-hover: 0 6px 20px rgba(0,0,0,0.2), 0 4px 12px rgba(91,143,199,0.4);
    --ds-pill-supported-bg: #e8f5e9;
    --ds-pill-supported-text: #2e7d32;
    --ds-pill-unsupported-bg: #fce4ec;
    --ds-pill-unsupported-text: #b71c1c;
    --ds-cell-ok-bg: #f0faf4;
    --ds-cell-ok-text: #2a7d4e;
    --ds-cell-warn-bg: #fefbf0;
    --ds-cell-warn-text: #9a6c00;
    --ds-cell-fail-bg: #fef5f5;
    --ds-cell-fail-text: #bb3333;
    --ds-provider-anthropic: #d97706;
    --ds-provider-gemini: #4285f4;
  }

  /* ===== Page layout ===== */
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: system-ui, -apple-system, sans-serif;
    background: var(--ds-page);
    color: var(--ds-primary);
    padding: 2rem;
  }

  h1 {
    font-size: 1.25rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: var(--ds-primary);
  }
  .page-subtitle {
    color: var(--ds-secondary);
    font-size: 0.85rem;
    margin-bottom: 2rem;
  }

  .states-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 2rem;
    max-width: 1200px;
  }

  .state-column {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .state-label {
    font-size: 0.7rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--ds-muted);
  }

  /* ===== Shared card container (the unified wrapper) ===== */
  .issues-card {
    background: var(--ds-surface);
    border: 1px solid var(--ds-border);
    border-radius: var(--ds-radius-md);
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }

  /* ---- Status header ---- */
  .card-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1rem;
    border-bottom: 1px solid var(--ds-border);
    font-size: 0.8rem;
    font-weight: 600;
  }
  .card-header .status-icon {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.7rem;
    font-weight: 700;
    flex-shrink: 0;
  }
  .card-header .status-icon.error {
    background: rgba(220, 53, 69, 0.12);
    color: var(--ds-error);
  }
  .card-header .status-icon.success {
    background: rgba(92, 184, 92, 0.12);
    color: var(--ds-success);
  }
  .card-header .status-icon.mixed {
    background: rgba(91, 143, 199, 0.12);
    color: var(--ds-accent);
  }
  .card-header .status-icon.warning {
    background: rgba(240, 173, 78, 0.12);
    color: var(--ds-warning);
  }

  .card-header .status-text {
    flex: 1;
  }
  .card-header .status-text .label {
    color: var(--ds-primary);
  }
  .card-header .status-text .sublabel {
    font-weight: 400;
    color: var(--ds-muted);
    font-size: 0.7rem;
  }

  /* ---- Content area ---- */
  .card-content {
    padding: 0.75rem 1rem;
    flex: 1;
  }

  /* ---- Action footer ---- */
  .card-footer {
    padding: 0.625rem 1rem;
    border-top: 1px solid var(--ds-border);
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background: var(--ds-surface-subtle);
  }
  .card-footer .footer-spacer {
    flex: 1;
  }

  /* ===== Buttons ===== */
  .btn {
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
    border: none;
    cursor: pointer;
    font-family: inherit;
    transition: all var(--ds-duration);
    border-radius: var(--ds-radius-sm);
  }
  .btn-primary {
    background: var(--ds-accent);
    color: #fff;
    font-size: 0.8rem;
    font-weight: 600;
    padding: 0.5rem 1rem;
    box-shadow: var(--ds-shadow-button);
  }
  .btn-primary:hover {
    background: var(--ds-accent-hover);
    box-shadow: var(--ds-shadow-button-hover);
  }
  .btn-success {
    background: var(--ds-success);
    color: #fff;
    font-size: 0.75rem;
    font-weight: 600;
    padding: 0.4rem 0.875rem;
    box-shadow: 0 2px 8px rgba(92,184,92,0.3);
  }
  .btn-success:hover {
    filter: brightness(1.08);
  }
  .btn-secondary {
    background: var(--ds-surface);
    color: var(--ds-secondary);
    font-size: 0.75rem;
    font-weight: 500;
    padding: 0.375rem 0.75rem;
    border: 1px solid var(--ds-border);
  }
  .btn-secondary:hover {
    color: var(--ds-primary);
    border-color: var(--ds-accent);
    background: var(--ds-surface-hover);
  }
  .btn-ghost {
    background: transparent;
    color: var(--ds-muted);
    font-size: 0.75rem;
    font-weight: 500;
    padding: 0.25rem 0.5rem;
  }
  .btn-ghost:hover {
    color: var(--ds-primary);
  }
  .btn-icon {
    width: 14px;
    height: 14px;
    flex-shrink: 0;
    opacity: 0.7;
  }

  /* ===== Issue rows ===== */
  .issue-row {
    display: flex;
    align-items: flex-start;
    gap: 0.5rem;
    padding: 0.5rem 0;
    font-size: 0.8rem;
    line-height: 1.5;
  }
  .issue-row + .issue-row {
    border-top: 1px solid var(--ds-border);
  }
  .severity-icon {
    flex-shrink: 0;
    font-size: 0.75rem;
    line-height: 1.5;
    width: 1rem;
    text-align: center;
  }
  .severity-icon.error { color: var(--ds-error); }
  .severity-icon.warning { color: var(--ds-warning); }
  .issue-line {
    font-family: ui-monospace, monospace;
    font-size: 0.7rem;
    color: var(--ds-muted);
    cursor: pointer;
    white-space: nowrap;
    flex-shrink: 0;
    text-decoration: none;
    line-height: 1.7;
  }
  .issue-line:hover {
    color: var(--ds-accent);
    text-decoration: underline;
  }
  .issue-message {
    color: var(--ds-secondary);
  }

  /* ===== Fix result rows ===== */
  .fix-section-label {
    font-size: 0.7rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.04em;
    margin-bottom: 0.375rem;
    display: flex;
    align-items: center;
    gap: 0.375rem;
  }
  .fix-section-label.applied { color: var(--ds-cell-ok-text); }
  .fix-section-label.unresolved { color: var(--ds-cell-fail-text); }

  .fix-row {
    display: flex;
    gap: 0.5rem;
    align-items: flex-start;
    font-size: 0.75rem;
    padding: 0.3rem 0;
    line-height: 1.5;
  }
  .fix-icon {
    flex-shrink: 0;
    width: 1rem;
    text-align: center;
    font-weight: 600;
  }
  .fix-icon.applied { color: var(--ds-success); }
  .fix-icon.info-lost { color: var(--ds-warning); }
  .fix-icon.unresolved { color: var(--ds-error); }
  .fix-desc {
    color: var(--ds-secondary);
  }
  .fix-note {
    color: var(--ds-muted);
    font-style: italic;
  }

  .fix-divider {
    border: none;
    border-top: 1px solid var(--ds-border);
    margin: 0.5rem 0;
  }

  /* ===== Compatible view ===== */
  .compatible-hero {
    text-align: center;
    padding: 1.5rem 1rem 1rem;
  }
  .compatible-icon {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background: rgba(92, 184, 92, 0.1);
    color: var(--ds-success);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    margin-bottom: 0.75rem;
  }
  .compatible-title {
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--ds-primary);
    margin-bottom: 0.25rem;
  }
  .compatible-subtitle {
    font-size: 0.75rem;
    color: var(--ds-muted);
    margin-bottom: 1rem;
  }
  .model-pills {
    display: flex;
    gap: 0.375rem;
    justify-content: center;
    flex-wrap: wrap;
  }
  .model-pill {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    font-size: 0.7rem;
    font-weight: 500;
    padding: 0.25rem 0.625rem;
    border-radius: 100px;
    background: var(--ds-pill-supported-bg);
    color: var(--ds-pill-supported-text);
  }
  .model-pill .pill-dot {
    width: 5px;
    height: 5px;
    border-radius: 50%;
    background: currentColor;
    opacity: 0.5;
  }

  /* ===== Annotations ===== */
  .annotation {
    font-size: 0.65rem;
    color: var(--ds-accent);
    background: var(--ds-accent-bg);
    border: 1px solid var(--ds-accent-muted);
    border-radius: var(--ds-radius-sm);
    padding: 0.375rem 0.625rem;
    margin-top: 0.5rem;
    line-height: 1.5;
  }
  .annotation strong {
    font-weight: 600;
  }

  /* ===== Section separator ===== */
  .section-break {
    border: none;
    border-top: 2px solid var(--ds-border);
    margin: 3rem 0 2rem;
  }

  .section-title {
    font-size: 1rem;
    font-weight: 600;
    color: var(--ds-primary);
    margin-bottom: 0.25rem;
  }
  .section-desc {
    font-size: 0.8rem;
    color: var(--ds-secondary);
    margin-bottom: 1.5rem;
  }

  /* ===== Flow diagram ===== */
  .flow-row {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1.5rem;
    max-width: 1200px;
  }
  .flow-step {
    flex: 1;
    text-align: center;
    padding: 0.75rem;
    background: var(--ds-surface);
    border: 1px solid var(--ds-border);
    border-radius: var(--ds-radius-md);
    font-size: 0.8rem;
    font-weight: 500;
  }
  .flow-step .step-label {
    font-size: 0.65rem;
    color: var(--ds-muted);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    margin-bottom: 0.25rem;
  }
  .flow-arrow {
    color: var(--ds-muted);
    font-size: 1.25rem;
    flex-shrink: 0;
  }

  /* Fix summary bar */
  .fix-summary-bar {
    display: flex;
    gap: 1rem;
    align-items: center;
    padding: 0.5rem 0.75rem;
    background: var(--ds-surface-subtle);
    border-radius: var(--ds-radius-sm);
    margin-bottom: 0.75rem;
    font-size: 0.75rem;
  }
  .fix-summary-stat {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    font-weight: 600;
  }
  .fix-summary-stat.applied { color: var(--ds-success); }
  .fix-summary-stat.unresolved { color: var(--ds-error); }

  /* Schema action label */
  .schema-action-label {
    font-size: 0.6rem;
    color: var(--ds-muted);
    text-transform: uppercase;
    letter-spacing: 0.06em;
    font-weight: 600;
  }

  /* ===== Cross-provider banner ===== */
  .cross-provider-banner {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 0.75rem;
    background: var(--ds-cell-warn-bg);
    border: 1px solid rgba(240, 173, 78, 0.25);
    border-radius: var(--ds-radius-sm);
    font-size: 0.7rem;
    color: var(--ds-cell-warn-text);
    margin-bottom: 0.75rem;
  }
  .cross-provider-banner .banner-icon {
    flex-shrink: 0;
    font-size: 0.8rem;
  }
  .cross-provider-banner .banner-text {
    flex: 1;
    line-height: 1.4;
  }
  .cross-provider-banner .banner-text strong {
    font-weight: 600;
  }
  .cross-provider-banner .banner-link {
    color: var(--ds-cell-warn-text);
    font-weight: 600;
    text-decoration: underline;
    text-decoration-style: dotted;
    text-underline-offset: 2px;
    cursor: pointer;
    white-space: nowrap;
  }
  .cross-provider-banner .banner-link:hover {
    text-decoration-style: solid;
  }

  /* Mini status chips (for other providers in banner) */
  .provider-chip {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    font-size: 0.65rem;
    font-weight: 600;
    padding: 0.125rem 0.5rem;
    border-radius: 100px;
    white-space: nowrap;
  }
  .provider-chip.ok {
    background: var(--ds-pill-supported-bg);
    color: var(--ds-pill-supported-text);
  }
  .provider-chip.error {
    background: var(--ds-pill-unsupported-bg);
    color: var(--ds-pill-unsupported-text);
  }
  .provider-chip.warning {
    background: var(--ds-cell-warn-bg);
    color: var(--ds-cell-warn-text);
  }

  /* ===== Server validation section ===== */
  .server-validate-section {
    border-top: 1px solid var(--ds-border);
    padding: 0.75rem 1rem;
    background: var(--ds-surface-subtle);
  }
  .server-validate-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
  }
  .server-validate-label {
    font-size: 0.65rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    color: var(--ds-muted);
  }
  .server-validate-hint {
    font-size: 0.7rem;
    color: var(--ds-muted);
    line-height: 1.4;
    margin-bottom: 0.5rem;
  }
  .server-validate-results {
    display: flex;
    flex-direction: column;
    gap: 0.375rem;
  }
  .server-result-row {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.7rem;
    padding: 0.375rem 0.625rem;
    background: var(--ds-surface);
    border: 1px solid var(--ds-border);
    border-radius: var(--ds-radius-sm);
  }
  .server-result-model {
    font-weight: 500;
    color: var(--ds-primary);
    flex: 1;
  }
  .server-result-status {
    font-size: 0.65rem;
    font-weight: 600;
    padding: 0.125rem 0.5rem;
    border-radius: 100px;
  }
  .server-result-status.ok {
    background: var(--ds-pill-supported-bg);
    color: var(--ds-pill-supported-text);
  }
  .server-result-status.fail {
    background: var(--ds-pill-unsupported-bg);
    color: var(--ds-pill-unsupported-text);
  }
  .server-result-latency {
    font-size: 0.6rem;
    color: var(--ds-muted);
    min-width: 3rem;
    text-align: right;
  }

  /* Server validate loading */
  .server-validate-loading {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.7rem;
    color: var(--ds-muted);
    padding: 0.5rem 0;
  }
  .spinner {
    width: 14px;
    height: 14px;
    border: 2px solid var(--ds-border);
    border-top-color: var(--ds-accent);
    border-radius: 50%;
    animation: spin 0.6s linear infinite;
  }
  @keyframes spin { to { transform: rotate(360deg); } }

  /* Other providers summary (in status cards area) */
  .other-providers-row {
    display: flex;
    gap: 0.375rem;
    flex-wrap: wrap;
    margin-bottom: 0.5rem;
  }
</style>
</head>
<body>

<h1>Issues Tab — Unified Redesign</h1>
<p class="page-subtitle">Combined issue: #23 (Fix Apply UX) + #24 (Compatible View) + cross-provider awareness + server validation integration.</p>

<!-- ========== STATE FLOW ========== -->
<div class="section-title">State Flow</div>
<div class="section-desc">The IssuesTab transitions between these states. Each shares the same card container with header, content, footer, and optional server validation section.</div>

<div class="flow-row">
  <div class="flow-step">
    <div class="step-label">State A</div>
    Issues Found
  </div>
  <div class="flow-arrow">→</div>
  <div class="flow-step">
    <div class="step-label">User clicks "Fix all"</div>
    Fixes Applied
  </div>
  <div class="flow-arrow">→</div>
  <div class="flow-step">
    <div class="step-label">State B</div>
    Post-Fix Results
  </div>
  <div class="flow-arrow">→</div>
  <div class="flow-step">
    <div class="step-label">User edits / re-validates</div>
    Re-validates
  </div>
  <div class="flow-arrow">→</div>
  <div class="flow-step" style="border-color: var(--ds-success);">
    <div class="step-label">State C</div>
    Compatible ✓
  </div>
</div>

<hr class="section-break" />

<!-- ========== 3 STATES SIDE BY SIDE ========== -->
<div class="section-title">Core States (per-provider view)</div>
<div class="section-desc">Each state shows the view for the currently selected provider. The card header, content, and footer adapt to the state.</div>

<div class="states-grid">

  <!-- ==================== STATE A: HAS ISSUES ==================== -->
  <div class="state-column">
    <div class="state-label">State A — Issues Found</div>

    <div class="issues-card">
      <!-- Header -->
      <div class="card-header">
        <div class="status-icon error">✕</div>
        <div class="status-text">
          <div class="label">3 issues found</div>
          <div class="sublabel">Structured Outputs</div>
        </div>
      </div>

      <!-- Content: issue list -->
      <div class="card-content">
        <div class="issue-row">
          <span class="severity-icon error">✕</span>
          <a class="issue-line">L6</a>
          <span class="issue-message"><code>oneOf</code> is not supported — use <code>anyOf</code> instead</span>
        </div>
        <div class="issue-row">
          <span class="severity-icon error">✕</span>
          <a class="issue-line">L7</a>
          <span class="issue-message"><code>integer</code> type not allowed — use <code>number</code></span>
        </div>
        <div class="issue-row">
          <span class="severity-icon warning">⚠</span>
          <a class="issue-line">L12</a>
          <span class="issue-message">Missing <code>additionalProperties: false</code></span>
        </div>
      </div>

      <!-- Footer -->
      <div class="card-footer">
        <button class="btn btn-primary">Fix all 3 issues</button>
      </div>
    </div>

    <div class="annotation">
      <strong>Same as today</strong> but wrapped in the shared card container.
      Header shows error count + ruleset name.
      Footer has the primary CTA.
    </div>
  </div>

  <!-- ==================== STATE B: POST-FIX ==================== -->
  <div class="state-column">
    <div class="state-label">State B — Fixes Applied</div>

    <div class="issues-card">
      <!-- Header -->
      <div class="card-header">
        <div class="status-icon mixed">✓</div>
        <div class="status-text">
          <div class="label">Fixes applied</div>
          <div class="sublabel">2 fixed · 1 needs manual fix</div>
        </div>
      </div>

      <!-- Content: fix results -->
      <div class="card-content">
        <!-- Summary bar -->
        <div class="fix-summary-bar">
          <span class="fix-summary-stat applied">✓ 2 applied</span>
          <span class="fix-summary-stat unresolved">! 1 unresolved</span>
        </div>

        <!-- Applied fixes -->
        <div class="fix-section-label applied">Applied</div>
        <div class="fix-row">
          <span class="fix-icon applied">+</span>
          <span class="fix-desc">Replaced <code>oneOf</code> with <code>anyOf</code></span>
        </div>
        <div class="fix-row">
          <span class="fix-icon info-lost">~</span>
          <span class="fix-desc">Wrapped root in object with <code>response</code> property</span>
          <span class="fix-note">— property name is generic</span>
        </div>

        <hr class="fix-divider" />

        <!-- Unresolved -->
        <div class="fix-section-label unresolved">Manual fix needed</div>
        <div class="fix-row">
          <span class="fix-icon unresolved">!</span>
          <span class="fix-desc">Recursive <code>$ref</code> detected — simplify manually</span>
          <span class="fix-note">— cannot auto-resolve</span>
        </div>
      </div>

      <!-- Footer -->
      <div class="card-footer">
        <button class="btn btn-secondary">Show Changes</button>
        <button class="btn btn-ghost">Undo</button>
        <div class="footer-spacer"></div>
        <span class="schema-action-label">Schema</span>
        <button class="btn btn-ghost">
          <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
          Copy
        </button>
        <button class="btn btn-ghost">
          <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
          Download
        </button>
      </div>
    </div>

    <div class="annotation">
      <strong>Key changes (#23):</strong><br>
      • Card stays visible — not dismissed on fix<br>
      • "Show Changes" opens Monaco diff view<br>
      • "Undo" reverts to pre-fix schema<br>
      • Summary bar gives quick glance at outcome
    </div>
  </div>

  <!-- ==================== STATE C: COMPATIBLE ==================== -->
  <div class="state-column">
    <div class="state-label">State C — Compatible</div>

    <div class="issues-card">
      <!-- Header -->
      <div class="card-header">
        <div class="status-icon success">✓</div>
        <div class="status-text">
          <div class="label">Compatible</div>
          <div class="sublabel">Structured Outputs</div>
        </div>
      </div>

      <!-- Content: celebration + model pills -->
      <div class="card-content">
        <div class="compatible-hero">
          <div class="compatible-icon">✓</div>
          <div class="compatible-title">Ready to use</div>
          <div class="compatible-subtitle">Your schema is fully compatible with this provider</div>
          <div class="model-pills">
            <span class="model-pill"><span class="pill-dot"></span>GPT-4o</span>
            <span class="model-pill"><span class="pill-dot"></span>GPT-4o-mini</span>
            <span class="model-pill"><span class="pill-dot"></span>o1</span>
            <span class="model-pill"><span class="pill-dot"></span>o3-mini</span>
          </div>
        </div>
      </div>

      <!-- Server validation integrated -->
      <div class="server-validate-section">
        <div class="server-validate-header">
          <span class="server-validate-label">Verify with real API</span>
        </div>
        <div class="server-validate-hint">
          Confirm compatibility by sending your schema to the actual provider API.
        </div>
        <button class="btn btn-success">Validate against OpenAI</button>
      </div>

      <!-- Footer -->
      <div class="card-footer">
        <span class="schema-action-label">Schema</span>
        <button class="btn btn-secondary">
          <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
          Copy Schema
        </button>
        <button class="btn btn-secondary">
          <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
          Download Schema
        </button>
      </div>
    </div>

    <div class="annotation">
      <strong>Key changes (#24 + server validation):</strong><br>
      • Hero with model pills<br>
      • "Validate against [provider]" appears naturally as next step<br>
      • Replaces the separate Server Test tab<br>
      • Only shown when locally compatible
    </div>
  </div>

</div>

<hr class="section-break" />

<!-- ========== CROSS-PROVIDER AWARENESS ========== -->
<div class="section-title">Addition 1: Cross-Provider Awareness</div>
<div class="section-desc">Fixing is per-provider but edits the shared schema. The user needs to know: "I fixed for OpenAI — what about the others?"</div>

<div class="states-grid" style="grid-template-columns: repeat(2, 1fr); max-width: 900px;">

  <!-- Post-fix for OpenAI — all good, but others have issues -->
  <div class="state-column">
    <div class="state-label">Just fixed for OpenAI — others still have issues</div>

    <div class="issues-card">
      <div class="card-header">
        <div class="status-icon success">✓</div>
        <div class="status-text">
          <div class="label">All issues fixed</div>
          <div class="sublabel">3 fixes applied for Structured Outputs</div>
        </div>
      </div>

      <div class="card-content">
        <!-- Cross-provider banner -->
        <div class="cross-provider-banner">
          <span class="banner-icon">⚠</span>
          <span class="banner-text">
            These fixes were applied for <strong>OpenAI</strong>. Other providers may still have issues:
          </span>
        </div>
        <div class="other-providers-row">
          <span class="provider-chip ok">✓ Anthropic</span>
          <span class="provider-chip error">✕ Gemini — 2 issues</span>
        </div>

        <hr class="fix-divider" />

        <div class="fix-summary-bar">
          <span class="fix-summary-stat applied">✓ 3 applied</span>
        </div>
        <div class="fix-row">
          <span class="fix-icon applied">+</span>
          <span class="fix-desc">Replaced <code>oneOf</code> with <code>anyOf</code></span>
        </div>
        <div class="fix-row">
          <span class="fix-icon applied">+</span>
          <span class="fix-desc">Changed <code>integer</code> to <code>number</code></span>
        </div>
        <div class="fix-row">
          <span class="fix-icon applied">+</span>
          <span class="fix-desc">Added <code>additionalProperties: false</code></span>
        </div>
      </div>

      <div class="card-footer">
        <button class="btn btn-secondary">Show Changes</button>
        <button class="btn btn-ghost">Undo</button>
        <div class="footer-spacer"></div>
        <span class="schema-action-label">Schema</span>
        <button class="btn btn-ghost">Copy</button>
        <button class="btn btn-ghost">Download</button>
      </div>
    </div>

    <div class="annotation">
      <strong>Cross-provider banner</strong> — appears in post-fix card when other providers still have issues.
      Shows chip per provider with status. Clicking a chip switches to that provider.
      Data comes from the existing <code>validationResults</code> Map — already computed for all providers.
    </div>
  </div>

  <!-- Switched to Gemini after fixing for OpenAI -->
  <div class="state-column">
    <div class="state-label">User clicks Gemini chip (or Gemini status card)</div>

    <div class="issues-card">
      <div class="card-header">
        <div class="status-icon error">✕</div>
        <div class="status-text">
          <div class="label">2 issues found</div>
          <div class="sublabel">Gemini</div>
        </div>
      </div>

      <div class="card-content">
        <!-- Context banner: you just fixed for OpenAI -->
        <div class="cross-provider-banner" style="background: var(--ds-accent-bg); border-color: var(--ds-accent-muted); color: var(--ds-accent);">
          <span class="banner-icon">i</span>
          <span class="banner-text" style="color: var(--ds-secondary);">
            Schema was recently fixed for <strong style="color: var(--ds-accent);">OpenAI</strong>. These are <strong>Gemini-specific</strong> issues.
          </span>
        </div>

        <div class="issue-row">
          <span class="severity-icon error">✕</span>
          <a class="issue-line">L4</a>
          <span class="issue-message"><code>$ref</code> with <code>$defs</code> not supported — inline the definition</span>
        </div>
        <div class="issue-row">
          <span class="severity-icon error">✕</span>
          <a class="issue-line">L18</a>
          <span class="issue-message"><code>pattern</code> keyword not supported by Gemini</span>
        </div>
      </div>

      <div class="card-footer">
        <button class="btn btn-primary">Fix all 2 issues</button>
      </div>
    </div>

    <div class="annotation">
      <strong>Context banner</strong> — when switching providers after a fix, a subtle info banner
      reminds the user what just happened and that these are provider-specific issues.<br><br>
      • fixResult is cleared on provider switch (current behavior — correct)<br>
      • Banner shows because we store <code>lastFixedForProvider</code> in state<br>
      • Banner disappears after user edits schema or applies another fix
    </div>
  </div>

</div>

<hr class="section-break" />

<!-- ========== SERVER VALIDATION INTEGRATION ========== -->
<div class="section-title">Addition 2: Server Validation Integration</div>
<div class="section-desc">
  Server validation (renamed from "Server Test") is the proof step. It moves from a separate tab into the Issues flow:
  when locally compatible, the card offers real API verification. When there are issues, it's hidden — no point validating a known-broken schema.
</div>

<div class="states-grid" style="grid-template-columns: repeat(3, 1fr); max-width: 1200px;">

  <!-- Compatible — verify CTA -->
  <div class="state-column">
    <div class="state-label">Compatible — verify available</div>

    <div class="issues-card">
      <div class="card-header">
        <div class="status-icon success">✓</div>
        <div class="status-text">
          <div class="label">Compatible</div>
          <div class="sublabel">Structured Outputs</div>
        </div>
      </div>

      <div class="card-content">
        <div class="compatible-hero">
          <div class="compatible-icon">✓</div>
          <div class="compatible-title">Ready to use</div>
          <div class="compatible-subtitle">Your schema passes all local validation rules</div>
          <div class="model-pills">
            <span class="model-pill"><span class="pill-dot"></span>GPT-4o</span>
            <span class="model-pill"><span class="pill-dot"></span>o1</span>
            <span class="model-pill"><span class="pill-dot"></span>o3-mini</span>
          </div>
        </div>
      </div>

      <!-- Server validation: ready to verify -->
      <div class="server-validate-section">
        <div class="server-validate-header">
          <span class="server-validate-label">Verify with real API</span>
        </div>
        <div class="server-validate-hint">
          Send this schema to OpenAI's API to confirm it works in production.
        </div>
        <button class="btn btn-success">Validate against OpenAI</button>
      </div>

      <div class="card-footer">
        <span class="schema-action-label">Schema</span>
        <button class="btn btn-secondary">Copy Schema</button>
        <button class="btn btn-secondary">Download Schema</button>
      </div>
    </div>

    <div class="annotation">
      <strong>Natural next step:</strong> "We say it's compatible — want to verify?"<br>
      Button says "Validate against [provider name]".<br>
      Requires sign-in (same as current Server Test).
    </div>
  </div>

  <!-- Compatible — validating... -->
  <div class="state-column">
    <div class="state-label">Verification in progress</div>

    <div class="issues-card">
      <div class="card-header">
        <div class="status-icon success">✓</div>
        <div class="status-text">
          <div class="label">Compatible</div>
          <div class="sublabel">Structured Outputs</div>
        </div>
      </div>

      <div class="card-content">
        <div class="compatible-hero">
          <div class="compatible-icon">✓</div>
          <div class="compatible-title">Ready to use</div>
          <div class="compatible-subtitle">Your schema passes all local validation rules</div>
          <div class="model-pills">
            <span class="model-pill"><span class="pill-dot"></span>GPT-4o</span>
            <span class="model-pill"><span class="pill-dot"></span>o1</span>
            <span class="model-pill"><span class="pill-dot"></span>o3-mini</span>
          </div>
        </div>
      </div>

      <!-- Server validation: loading -->
      <div class="server-validate-section">
        <div class="server-validate-header">
          <span class="server-validate-label">Verifying with OpenAI API...</span>
        </div>
        <div class="server-validate-loading">
          <span class="spinner"></span>
          Sending schema to 3 models...
        </div>
      </div>

      <div class="card-footer">
        <span class="schema-action-label">Schema</span>
        <button class="btn btn-secondary">Copy Schema</button>
        <button class="btn btn-secondary">Download Schema</button>
      </div>
    </div>

    <div class="annotation">
      Loading state while API calls are in flight.
      Tests all models in the ruleset concurrently.
    </div>
  </div>

  <!-- Compatible — verified! -->
  <div class="state-column">
    <div class="state-label">Verified — all models pass</div>

    <div class="issues-card">
      <div class="card-header" style="background: var(--ds-cell-ok-bg);">
        <div class="status-icon success">✓</div>
        <div class="status-text">
          <div class="label" style="color: var(--ds-cell-ok-text);">Verified</div>
          <div class="sublabel">Confirmed by OpenAI API</div>
        </div>
      </div>

      <div class="card-content">
        <div class="compatible-hero">
          <div class="compatible-icon" style="background: rgba(92,184,92,0.15); font-size: 1.75rem;">✓</div>
          <div class="compatible-title">Verified compatible</div>
          <div class="compatible-subtitle">Real API calls confirmed your schema works</div>
          <div class="model-pills">
            <span class="model-pill"><span class="pill-dot"></span>GPT-4o</span>
            <span class="model-pill"><span class="pill-dot"></span>o1</span>
            <span class="model-pill"><span class="pill-dot"></span>o3-mini</span>
          </div>
        </div>
      </div>

      <!-- Server validation: results -->
      <div class="server-validate-section">
        <div class="server-validate-header">
          <span class="server-validate-label">API verification results</span>
        </div>
        <div class="server-validate-results">
          <div class="server-result-row">
            <span class="server-result-model">GPT-4o</span>
            <span class="server-result-status ok">OK</span>
            <span class="server-result-latency">142ms</span>
          </div>
          <div class="server-result-row">
            <span class="server-result-model">o1</span>
            <span class="server-result-status ok">OK</span>
            <span class="server-result-latency">238ms</span>
          </div>
          <div class="server-result-row">
            <span class="server-result-model">o3-mini</span>
            <span class="server-result-status ok">OK</span>
            <span class="server-result-latency">187ms</span>
          </div>
        </div>
      </div>

      <div class="card-footer">
        <span class="schema-action-label">Schema</span>
        <button class="btn btn-secondary">Copy Schema</button>
        <button class="btn btn-secondary">Download Schema</button>
      </div>
    </div>

    <div class="annotation">
      <strong>Verified state:</strong> header turns green with "Verified" label.<br>
      "Confirmed by [provider] API" gives user confidence.<br>
      Per-model results with latency shown inline.<br>
      This is the "gold standard" — our rules + real API agree.
    </div>
  </div>

</div>

<!-- Server validation — failure case -->
<div style="max-width: 400px; margin-top: 2rem;">
  <div class="state-label">Edge case: API rejects despite local pass</div>

  <div class="issues-card" style="margin-top: 0.75rem;">
    <div class="card-header" style="background: var(--ds-cell-fail-bg);">
      <div class="status-icon warning">!</div>
      <div class="status-text">
        <div class="label" style="color: var(--ds-cell-fail-text);">Verification failed</div>
        <div class="sublabel">1 of 3 models rejected the schema</div>
      </div>
    </div>

    <div class="card-content" style="padding: 0.5rem 1rem;">
      <div style="font-size: 0.7rem; color: var(--ds-muted); margin-bottom: 0.5rem; line-height: 1.4;">
        Our local rules said this was compatible, but the API disagreed.
        This may indicate a rule we haven't documented yet.
      </div>
    </div>

    <div class="server-validate-section">
      <div class="server-validate-header">
        <span class="server-validate-label">API verification results</span>
      </div>
      <div class="server-validate-results">
        <div class="server-result-row">
          <span class="server-result-model">GPT-4o</span>
          <span class="server-result-status ok">OK</span>
          <span class="server-result-latency">142ms</span>
        </div>
        <div class="server-result-row" style="border-color: rgba(220,53,69,0.3);">
          <span class="server-result-model">o1</span>
          <span class="server-result-status fail">Failed</span>
          <span class="server-result-latency">—</span>
        </div>
        <div style="font-size: 0.65rem; color: var(--ds-error); padding: 0.25rem 0.625rem; line-height: 1.4;">
          "Invalid schema: property 'metadata' exceeds maximum nesting depth"
        </div>
        <div class="server-result-row">
          <span class="server-result-model">o3-mini</span>
          <span class="server-result-status ok">OK</span>
          <span class="server-result-latency">187ms</span>
        </div>
      </div>
    </div>

    <div class="card-footer">
      <span class="schema-action-label">Schema</span>
      <button class="btn btn-secondary">Copy Schema</button>
      <button class="btn btn-secondary">Download Schema</button>
    </div>
  </div>

  <div class="annotation">
    <strong>Honesty over confidence:</strong> When API disagrees with our local rules,
    we tell the user clearly. Error message from the API is shown verbatim.
    This is also valuable feedback for us to improve rules.
  </div>
</div>

<hr class="section-break" />

<!-- ========== TAB STRUCTURE ========== -->
<div class="section-title">Tab Changes</div>
<div style="max-width: 700px; font-size: 0.85rem; color: var(--ds-secondary); line-height: 1.7;">
  <p><strong>Before:</strong> 3 tabs — Issues | Reference | Server Test</p>
  <p><strong>After:</strong> 2 tabs — Issues | Reference</p>
  <br>
  <p>"Server Test" becomes "Server Validation" and moves <strong>inside</strong> the Issues card. It appears only when the schema is locally compatible (no issues). This makes it a natural continuation of the flow rather than a disconnected feature in a separate tab.</p>
  <br>
  <p>The tab is renamed from "Server Test" to nothing — it's no longer a tab. The functionality appears contextually as part of the compatible state.</p>
</div>

<hr class="section-break" />

<!-- ========== DESIGN DECISIONS ========== -->
<div class="section-title">Design Decisions</div>
<div style="max-width: 700px; font-size: 0.85rem; color: var(--ds-secondary); line-height: 1.7;">
  <p><strong>1. Shared card container</strong> — All states use the same border/bg/radius. The header changes color and icon to signal status.</p>
  <br>
  <p><strong>2. Cross-provider banner (in post-fix view)</strong> — After fixing for one provider, a yellow banner shows the status of other providers. Provider chips are clickable — they switch to that provider. This uses existing <code>validationResults</code> Map data, no new computation needed.</p>
  <br>
  <p><strong>3. Context banner (on provider switch after fix)</strong> — When switching to another provider after fixing, a subtle blue info banner says "Schema was recently fixed for [provider]. These are [other]-specific issues." This disappears after any schema edit. Driven by new <code>lastFixedForProvider: string | null</code> state.</p>
  <br>
  <p><strong>4. Server validation as natural next step</strong> — Instead of hiding in a separate tab, it appears at the bottom of the Compatible card as "Verify with real API". This makes the flow: validate locally → see compatible → verify with API → confirmed. Only shown when issues = 0.</p>
  <br>
  <p><strong>5. Verified state</strong> — When API confirms compatibility, the header upgrades from "Compatible" to "Verified" with a green background. This is the strongest confidence signal we can give.</p>
  <br>
  <p><strong>6. API disagreement honesty</strong> — When our rules say "compatible" but the API rejects, we show the API error verbatim and tell the user our rules may be incomplete. This builds trust and gives us feedback to improve rules.</p>
  <br>
  <p><strong>7. Provider-scoped fixes</strong> — The fix button always says "Fix for [provider]". The schema change is global (shared editor), but the intent is scoped. The cross-provider banner makes this explicit.</p>
</div>

<hr class="section-break" />

<!-- ========== IMPLEMENTATION NOTES ========== -->
<div class="section-title">Implementation Notes</div>
<div style="max-width: 700px; font-size: 0.85rem; color: var(--ds-secondary); line-height: 1.7;">
  <p><strong>New state:</strong></p>
  <ul style="margin: 0.5rem 0 1rem 1.25rem;">
    <li><code>preFixSchema: string | null</code> — stored before fix, enables diff + undo</li>
    <li><code>lastFixedForProvider: string | null</code> — tracks which provider was just fixed, enables context banners. Cleared on schema edit.</li>
    <li><code>serverValidationResults: Map&lt;string, ValidationResult[]&gt;</code> — keyed by ruleSetId, cached per schema+ruleSet combo. Cleared when schema changes.</li>
  </ul>

  <p><strong>Cross-provider banner logic:</strong></p>
  <ul style="margin: 0.5rem 0 1rem 1.25rem;">
    <li>After fix applied: iterate <code>validationResults</code> for all providers except current</li>
    <li>Show chip per provider: ✓ if errorCount === 0, ✕ N issues if errorCount &gt; 0</li>
    <li>Chips are clickable → call <code>onSelectRuleSet(ruleSetId)</code></li>
    <li>Only shown in post-fix state (fixResult !== null)</li>
  </ul>

  <p><strong>Context banner logic:</strong></p>
  <ul style="margin: 0.5rem 0 1rem 1.25rem;">
    <li>Show when: <code>lastFixedForProvider !== null && lastFixedForProvider !== selectedRuleSetId</code></li>
    <li>Clear when: schema changes or user fixes for this provider too</li>
  </ul>

  <p><strong>Server validation integration:</strong></p>
  <ul style="margin: 0.5rem 0 1rem 1.25rem;">
    <li>Move existing <code>ServerTestTab</code> logic into the compatible state of <code>IssuesTab</code></li>
    <li>Same API call (<code>/api/validate</code>), same auth requirement</li>
    <li>Only render the "Verify" section when <code>markers.length === 0</code> (locally compatible)</li>
    <li>Remove "Server Test" tab from dashboard tabs</li>
    <li>Results cached per schema+ruleSet to avoid redundant calls</li>
  </ul>

  <p><strong>Show Changes (diff view):</strong></p>
  <ul style="margin: 0.5rem 0 1rem 1.25rem;">
    <li>Monaco <code>createDiffEditor()</code> with <code>preFixSchema</code> (left) and current schema (right)</li>
    <li>"Close Diff" button returns to normal editor</li>
  </ul>
</div>

</body>
</html>
